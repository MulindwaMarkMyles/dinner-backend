{% extends 'admin_base.html' %}

{% block title %}Dashboard - Admin{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
	<h1 class="h2 mb-0">Dashboard Overview</h1>
	<span class="text-muted">{{ current_time|date:"F d, Y H:i" }}</span>
</div>

<div class="row g-3 mb-4">
	<div class="col-md-3">
		<div class="card stat-card">
			<h2>{{ total_users }}</h2>
			<p>Total Users</p>
		</div>
	</div>
	<div class="col-md-3">
		<div class="card stat-card">
			<h2>{{ total_drinks }}</h2>
			<p>Drink Types</p>
		</div>
	</div>
	<div class="col-md-3">
		<div class="card stat-card">
			<h2>{{ pending_orders_count }}</h2>
			<p>Pending Orders</p>
		</div>
	</div>
	<div class="col-md-3">
		<div class="card stat-card">
			<h2>{{ total_meals_today }}</h2>
			<p>Meals Today</p>
		</div>
	</div>
</div>

<div class="row g-4">
	<div class="col-md-6">
		<div class="card">
			<div class="card-header bg-white border-bottom">
				<h5 class="mb-0">Recent Drink Orders</h5>
			</div>
			<div class="card-body p-0">
				<div class="table-responsive">
					<table class="table table-hover mb-0">
						<thead>
							<tr>
								<th>User</th>
								<th>Drink</th>
								<th>Quantity</th>
								<th>Time</th>
							</tr>
						</thead>
						<tbody>
							{% for order in recent_orders %}
							<tr>
								<td>{{ order.user.full_name }}</td>
								<td>{{ order.drink_type.name }}</td>
								<td>{{ order.quantity }}</td>
								<td>{{ order.served_at|date:"H:i" }}</td>
							</tr>
							{% empty %}
							<tr><td colspan="4" class="text-center text-muted py-3">No recent orders</td></tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<div class="col-md-6">
		<div class="card">
			<div class="card-header bg-white border-bottom">
				<h5 class="mb-0">Low Stock Alert</h5>
			</div>
			<div class="card-body p-0">
				<div class="table-responsive">
					<table class="table table-hover mb-0">
						<thead>
							<tr>
								<th>Drink</th>
								<th>Available</th>
								<th>Status</th>
							</tr>
						</thead>
						<tbody>
							{% for drink in low_stock_drinks %}
							<tr>
								<td>{{ drink.name }}</td>
								<td>{{ drink.available_quantity }}</td>
								<td>
									{% if drink.available_quantity < 10 %}
									<span class="badge bg-danger">Critical</span>
									{% elif drink.available_quantity < 30 %}
									<span class="badge bg-warning">Low</span>
									{% endif %}
								</td>
							</tr>
							{% empty %}
							<tr><td colspan="3" class="text-center text-muted py-3">All drinks well stocked</td></tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}
